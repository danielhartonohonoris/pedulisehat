<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('layouts/header.ejs') %>

</head>
<body id="top">
  <%- include('layouts/navdash.ejs') %>
  <main>
    <article>
      <section class="section hero" style="background-image: url('./assets/images/hero-bg.png')" aria-label="home">
        <div class="container">
          <div class="hero-content">
            <h2>CRUD MAKANAN</h2>
            <form id="foodForm" action="/food" method="POST" enctype="multipart/form-data">
                <input type="file" name="image">
                <input type="text" name="title" placeholder="Title">
                <textarea name="description" placeholder="Description"></textarea>
                <select name="role" id="role">
                  <option value="sayuran">Sayuran</option>
                  <option value="ikan">Ikan</option>
                  <option value="buah">Buah</option>
                </select>
                <button type="button" onclick="submitFormFood()">Add Food</button>
            </form>
            <p class="hero-subtitle has-before" data-reveal="left">Crud Makanan</p>
            <h1 class="headline-lg hero-title" data-reveal="left">
              Layanan Informasi 
              Cepat Dan Tepat. <br>
            </h1>
          </div>
        </div>
      </section>
    </article>
  </main>
  <div class="box-container">
    <% todoListItems.forEach(item => { %>
      <div class="box <%= item.role %>">
        <img src="../uploads/<%= item.image %>" alt="<%= item.image %>">
        <h3><%= item.title %></h3>
        <p><%= item.description %></p>
        <form id="deleteForm_<%= item._id %>" action="/food/<%= item._id %>" method="POST">
            <input type="hidden" name="_method" value="DELETE">
            <button type="button" onclick="deleteFood('<%= item._id %>')">Hapus</button>
        </form>
        <form id="editForm_<%= item._id %>" style="display: none;" method="POST" action="/food/<%= item._id %>?_method=PUT" enctype="multipart/form-data">
            <input type="hidden" name="_method" value="PUT">
            <input type="text" name="title" class="editTitle" placeholder="Title" value="<%= item.title %>">
            <textarea name="description" class="editDescription" placeholder="Description"><%= item.description %></textarea>
            <select name="role" class="editRole"> <!-- Add select field for role -->
                <option value="sayuran" <%= item.role === 'sayuran' ? 'selected' : '' %>>Sayuran</option>
                <option value="ikan" <%= item.role === 'ikan' ? 'selected' : '' %>>Ikan</option>
                <option value="buah" <%= item.role === 'buah' ? 'selected' : '' %>>Buah</option>
            </select>
            <input type="file" name="image" class="editImage">
            <button type="submit">Simpan</button>
        </form>
        
        

        
        <button type="button" onclick="showEditForm('<%= item._id %>')">Edit</button>
      </div>
    <% }) %>
  </div>
  <form id="updateForm" style="display: none;" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="_method" value="PUT">
    <input type="text" name="title" id="updateTitle" placeholder="Title">
    <textarea name="description" id="updateDescription" placeholder="Description"></textarea>
    <input type="text" name="role" id="updateRole" placeholder="Role"> <!-- Tambahkan input untuk role -->
    <input type="file" name="image" id="updateImage">
    <button type="button" onclick="submitUpdateForm()">Simpan</button>
</form>


  <script src="/js/script.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

  ...
  <script>
      function showEditForm(foodId) {
          document.getElementById('editForm_' + foodId).style.display = 'block';
      }
  
      function submitEditForm(foodId) {
          var form = document.getElementById("editForm_" + foodId);
          var formData = new FormData(form);
  
          var xhr = new XMLHttpRequest();
          xhr.open("POST", form.action, true);
          xhr.onload = function() {
              if (xhr.status === 200) {
                  console.log("Perubahan berhasil disimpan!");
                  window.location.reload();
              } else {
                  console.error("Terjadi kesalahan saat menyimpan perubahan.");
              }
          };
          xhr.onerror = function() {
              console.error("Terjadi kesalahan koneksi.");
          };
          xhr.send(formData);
      }
  
      function submitFormFood() {
          var form = document.getElementById("foodForm");
          var formData = new FormData(form);
  
          var xhr = new XMLHttpRequest();
          xhr.open("POST", form.action, true);
          xhr.onload = function() {
              if (xhr.status === 200) {
                  console.log("Makanan berhasil ditambahkan!");
                  window.location.reload();
              } else {
                  console.error("Terjadi kesalahan saat menambahkan makanan.");
              }
          };
          xhr.onerror = function() {
              console.error("Terjadi kesalahan koneksi.");
          };
          xhr.send(formData);
      }
  
      function submitUpdateForm() {
          var form = document.getElementById("updateForm");
          var formData = new FormData(form);
  
          var xhr = new XMLHttpRequest();
          xhr.open("PUT", form.action, true);
          xhr.onload = function() {
              if (xhr.status === 200) {
                  console.log("Perubahan berhasil disimpan crudFood!");
                  window.location.reload();
              } else {
                  console.error("Terjadi kesalahan saat menyimpan perubahan.");
              }
          };
          xhr.onerror = function() {
              console.error("Terjadi kesalahan koneksi.");
          };
          xhr.send(formData);
      }
  
      function deleteFood(foodId) {
          if (confirm("Apakah Anda yakin ingin menghapus makanan ini?")) {
              var xhr = new XMLHttpRequest();
              xhr.open("DELETE", "/food/" + foodId, true);
              xhr.onload = function() {
                  if (xhr.status === 200) {
                      console.log("Makanan berhasil dihapus!");
                      window.location.reload();
                  } else {
                      console.error("Terjadi kesalahan saat menghapus makanan.");
                  }
              };
              xhr.send();
          }
      }
  </script>

</body>
</html>
